const container = document.getElementById('card-container');
const selected = document.getElementById('selected-cards');
const cardCount = 23;

function preloadImages(count) {
  for (let i = 1; i <= count; i++) {
    const img = new Image();
    img.src = `img/${i}.jpg`;
  }
}
preloadImages(cardCount);


const selectedIds = new Set();
const titles = {
  "1": {"title": "THE FOOL 愚者", 
  "desc": "愚者とは信頼し続ける人です。愚者とはすべての経験に対して信頼し続ける人です。あなたが彼を騙しても、彼はあなたを信頼します。再び彼を騙しても、彼はあなたを信頼します。また再び彼を騙しても、彼はあなたを信頼します。愚者は学習しないと言うでしょう。彼の信頼は絶大です。誰もそれを邪魔することはできません。禅において、道教において愚者であること。知識の壁を作らないでください。どんな経験も受け入れて、続けてください。心をクリアにしてください。過去に対して無感覚になり、いま生まれたかのように、生きましょう。最初はとても難しいでしょう。世間があなたを利用し始めます。ぜひそうさせてください。彼らは哀れな人たちです。たとえ騙されて、騙されて、奪われたとしても、誰もあなた自身を奪うことはできません。あなたが堕落しない限り、その機会が自分の内側を統合します。魂はより結晶化し明晰なものになるでしょう。ライダー版タロットはこちら"},
  "2": {"title": "EXISTENCE 存在", 
  "desc": "存在はあなたを必要としています。誰も代わりはいません。星、太陽、月、木、鳥、土、、、、宇宙のすべては、誰もあなたの代わりにはなりません。これは喜びであり、存在に関する満足感を与えてくれます。"},
  "3": {"title": "INNER VOICE 内なる声", 
  "desc": "自分の中に真理を見つけたら、見つけるべきものは何もありません。真理は自分を通して作用します。目を開くとき、目を開けるのは真理です。目を閉じるとき、目を閉じるのは真理です。これは素晴らしい瞑想です。根拠が理解できていれば、何もする必要はありません。自分がしていることは真理によってなされています。歩いている。それは真理。眠っている。休息しているのは真理。話している。話しているのは真理。黙っている。沈黙しているのは真理。これはもっともシンプルな瞑想法のひとつです。ゆっくり、ゆっくり、すべてはこの簡単な方法によって、落ち着きます。技術は必要ありません。癒されたら、瞑想を捨て、薬を捨てる。そして真理として生きる。生き生きと、光り輝き、満足して、幸福に満ち溢れ、自身の歌になる。日常の世界にに属さない優美、美しさ、暗闇からの光線、生は言葉なく祈りになる。もしくは、よくなるために祈りなさい。"},
  "4": {"title": "CREATIVITY 創造性", 
  "desc": "創造力はあなたがしていることに働きをもたらす素晴らしいもの。それは内なるアプローチ。あなたはそれをどのように見ますか？誰もが画家になれるわけではないし、なる必要はない。誰もが画家になれれば、世界はとてもやっかい。誰もがダンサーになれるわけではないし、なる必要はない。しかし、誰もが創造的。どんなことでも嬉しそうにしているなら、愛情をこめているなら、お金のためではなく純粋な心であれば、それは創造的です。"},
  "5": {"title": "THE REBEL 反逆者", 
  "desc": "誰かと、あるいはなにかと闘っているからではなく、自分自身の本性を発見し、その通りに生きようと決心しているからです。彼のスピリット・アニマルは鷲(わし) 、地と空のあいだのメッセンジャーです。「反逆者」は、自分自身としてあることの責任を取り、自分たちの真理を生きる勇気をもつようにと私たちを促しています。"},
  "6": {"title": "NO-THINGNESS ノー・シングネス（無）", 
  "desc": "ブッダはとても潜在的な言葉のひとつを選んだ。「shunyata」(空)英語では「nothingness」(無)に相当しますが、とりわけ美しい言葉ではありません。なぜなら「nothing」は何もない、それだけ。だから「no-thingness」 にしました。あらゆる可能性があり、活気があります。潜在的で絶対的です。まだ不十分ですが、すべてがあります。自然に始まり、自然に終わるのに、なぜ、そんなに大騒ぎするのですか？なぜ、心配して、野心的になるのですか？なぜ、絶望するのですか？無から無へ、それが旅のすべてだ。"},
  "7": {"title": "THE LOVERS 恋人たち", 
  "desc": "もっとも低い愛はセックス。それは肉体的なものです。もっとも高い愛は慈愛。慈愛は愛を超えます。愛が何であるかわかっている人は極めて少ない。99％が性的関係が愛であると思っています。それは違います。性的関心は、動物的なものです。それは愛になる可能性がありますが、本当の愛ではありません。それに気づくことができたら、性欲を愛へと変容することができます。セックスは種です。愛は花です。慈愛は香りです。ブッダは慈愛を「愛と瞑想」と定義しました。あなたの愛がただの欲望ではなく、愛がシェアされるとき、愛は乞食ではなく、皇帝であるとき、愛が見返りを求めていないとき、与えるための喜びの準備ができたとき、1愛に瞑想を加えると、純粋な香りがリリースされます。それは慈愛です。慈愛はもっとも高い現象です。"},
  "8": {"title": "AWARENESS 覚醒", 
  "desc": "思考を賢くすることはできません。無心だけが賢い。無心は革命的です。思考はあなたを麻痺させます。過去の記憶からの重荷。将来の不安からの重荷。それでもあなたは最小限に生きていかなければなりません。あなたは最大限に生きていません。あなたの炎はとてもぼやけています。考えを捨て始めると、過去のゴミがでてきて、炎が生じます。それは透明で、クリアで、いきいきとしていて若い。あなたの人生は炎となり、その炎の煙はたちません。これが覚醒たるものです。"},
  "9": {"title": "COURAGE 勇気", 
  "desc": "種はこれから何が起きるか知りません。ましてや種が花になるなんて。旅は長く、保証もない未知の世界。旅に行かないほうが安全です。種は硬い殻に覆われて安全ですが、種から出ようとすれば危険が待ち受けています。でも種はトライします。殻を破って動き出します。闘いは始まりました。岩と石と土との闘い。種はとても硬いので危険はありませんでしたが、新芽はとても柔らかく危険が多くなります。しかし、新芽は光の方へ、太陽の方へ未知の世界へ伸び始めます。種は夢に向かって進んでいきます。人間も同じです。未知の世界に進むのは困難で、多くの勇気が必要です。"},
  "10": {"title": "ALONENESS 独りあること", 
  "desc": "ひとりでいるとき、あなたは独りではいない。ただ寂しいだけだ。寂しさと独りあること、そのあいだには途方もない違いがある。寂しさはネガティヴな状態だ。寂しさは他者の不在だ。独りあることは自己の現存だ。独りあることはひじょうにポジティヴだ。あなたはあまりにも現存に満ちあふれているので、自己の現存で全宇宙を満たすことができるし、誰かを求める必要もない。"},
  "11": {"title": "CHANGE 変化", 
  "desc": "それは車輪のように回る。誕生の次に死が来て、死の次に誕生が来る。愛の次に憎しみが来て、憎しみの次に愛が来る。成功の次に失敗が来て、失敗の次に成功が来る。"},
  "12": {"title": "BREAKTHROUGH 突破", 
  "desc": "カオス古いパターンを壊すバランスを保つ挫折をブレイクスルーに変えることはマスターの役目です。サイコセラピスト(心理療法士)はシンプルに絆創膏を貼るだけです。それがサイコセラピストの役目です。サイコセラピストはあなたを変容させません。あなたはメタ心理学を必要とします。意識的に挫折を経験することは人生でもっとも素晴らしい冒険です。挫折がブレイクスルーになるという保証はありません。キャパシティが小さいと、とても危険です。禅や瞑想をすることでバランスが保たれ、カオスな思考をを助けることができます。夜明けは近いです。しかし夜明けを迎える前に、暗い夜を超えなければなりません。夜明けは近づきますが、夜は次第に暗くなります。"},
  "13": {"title": "NEW VISION 新しいビジョン", 
  "desc": "あなたが究極までいくとそれはあなたの注ぎ込まれます。もはや普通の人間ではなく、超越しています。あなたの洞察はもはや全体を洞察しています。今あなたは離れていません。自分のルーツを見つけました。誰もが根を失うことなく自分の心がエネルギーを受け取って、どこからきているのかを知らずに、誰が呼吸しているのかわからず、内側で生のジュースが走っているのを知らない。それは体ではなく、心でもありません。それは二元性と呼ばれている超絶的な何かです。内面が開かれたとき、高さと深さの2つの方向を経験します。そしてゆっくり、ゆっくり、それが確立された状態になると他の8つの方向すべてに広がります。そして自分と合った深さに到達すると、宇宙のまわりを見回すことができます。そうなると意識は10方向すべてで開かれますが、道はひとつです。"},
  "14": {"title": "TRANSFORMATION 変容", 
  "desc": "禅のマスターは単なる先生ではない。すべての宗教に先生はいません。マスターはあなたが知らないことを教えてくれます。しかし経験を現実に反映する方法しかないので、自分の信念を解きます。禅は信者の世界ではありません。信心深い人のためではありません。信仰、不信仰、疑念、理性、マインドを落とし、単に境界なしに純粋な存在に入ることができる魂のためです。それはとてつもない変化をもたらします。それゆえに他の人が哲学に関わっている間禅は変容に関わっている。これが本物の錬金術です。錬金術は卑金属を金属に変えます。しかし推測や知識ではなく愛する心でその言葉は理解されなければなりません。または真実かどうかも悩むことなく、ただ聴きます。そして突然、変容する瞬間が訪れます。いままでの人生ではそれを受け流しています。突然、ゴーダマブッダが8万4千の扉と呼んでいたものが開きます。"},
  "15": {"title": "INTEGRATION 統合", 
  "desc": "人間は対立する。そこで解決されない限り、どこでも解決することはありません。あなたは心の中で駆け引きをします。そこに橋がかかっています。でも、その橋が壊れてしまったら、心は分断され、統合失調症や、多重人格になります。朝はとても優しくて美しいですが、夜はとてもイライラしています。朝の状態を憶えていません。どうやったら憶えていられるでしょうか？もうひとつの心が動いている。その人は多重人格です。心の橋を直して、さらに強めることができたら、心は統合され、結晶化し始めるでしょう。ゲオルギー・グルジェフが「実存の結晶化」と呼んでいたものは、ふたつの心がひとつになることです。男性と女性の出会い、陰と陽の出会い、左と右の出会い、合理と非合理の出会い、プラトンとアリストテレスの出会いだ。"},
  "16": {"title": "CONDITIONING 条件付け", 
  "desc": "あなたの人格をなくさないかぎり、あなたの個性を見つけることはできません。個性は存在によって与えられます。人格は社会によって形成されます。人格は社会的な利便性を求めます。個性は羊のように従わないので、社会は個性を容認することはできません。個性はライオンの質を持っています。ライオンは独りで動きます。羊は群れの中にいれば居心地がいい思っています。群れの中にいれば保護され安全だと思っていて、誰かに攻撃されても群れの中にいれば自分は助かる可能性があります。独りでいたら助かるでしょうか？でもライオンは独りで動く。みなさんはライオンとして生まれています。社会はあなたを羊のようにプログラミングして調整します。それは都合のいい人格、とても便利で従順です。社会は奴隷を望んでいます。自由に身を捧げて欲しくありません。社会が奴隷を望むのは、利権を持つものが従順を求めるからです。"},
  "17": {"title": "THUNDERBOLT 稲妻", 
  "desc": "瞑想とはなにか？弟子が質問をしたところ、不意にマスターは喝を入れた。弟子を叩いた。弟子を投げた。弟子の上に乗った。この技法は誰も知らない。馬祖のたぐいまれな創造的な才能で、多くの人がそれで悟りを開いた。それはとても愉快に見える。瞑想とはなにかと聞いた弟子を2階の窓から放り投げた。そしてその上に飛びかかり、胸ぐらを掴み「どうだ？わかったか？」と尋ねた。「はい」とかわいそうな弟子はいいました。もし、「いいえ」と答えれば彼に何をされるかわかりません。「よし！これで十分だろう！」弟子は骨折していた。でも馬祖は弟子の胸の上に座り「悟りを得たか？」と聞いた。実際、弟子は悟りを開いた。あまりにも突然で、晴天の霹靂だった。そんなことは想像もしていなかったからだ。"},
  "18": {"title": "SILENCE 沈黙", 
  "desc": "あなたの沈黙と響き合うことのできる人たちを探すか、あるいは、独りあることを楽しめばいいのです。今こそあなた自身に帰る時です。"},
  "19": {"title": "PAST LIVES 過去生", 
  "desc": "存在の両手が女性生殖器、宇宙の母の開口部を形づくっています。その内部には、過去の多くのイメージ、顔が現れています。自分は過去生では有名だったのだと空想するのは面白いでしょうが、それは慰めに過ぎません。本当の要点は生のカルマのパターンと、そのパターンの根。私たちを無意識な振る舞いの罠にかけ、果てしなく繰り返されるサイクルの中にある根をみて理解することにあります。"},
  "20": {"title": "INNOCENCE 無垢", 
  "desc": "禅はこういいます。あなたの名前、アイデンティティを含むすべての知識、これは他の人から与えられたものです。その知識をすべて削除した時、あなたの存在はまったく異なるものになるでしょう。これはベルソナと人格の磔であり、それらは無垢の復活となり、ふたたび子どもとなって生まれ変わるでしょう。"},
  "21": {"title": "BEYOND ILLUSION 幻想を超えて", 
  "desc": "これは夢と現実の唯一の区別です。現実は疑うことを許し、夢は疑いを与えません。疑うことは人類にとって祝福のひとつです。宗教は疑いの根を根絶しているため、敵だとしています。それには理由があります。説教という幻想を人に信じさせたいからです。ブッダのような存在は夢で作られているのか儚い。木はそこにないと言っているわけではありません。柱がそこにないと言っているわけではありません。誤解しないでください。幻想。それは正しい言葉ではありません。幻想は存在しません。現実は存在します。マーヤは中間にあります。それはほとんど存在します。日々、現実とみなすことができます。究極の感覚のとき、幻想は現実ではなくなります。"},
  "22": {"title": "COMPLETION 完成", 
  "desc": "禅のやり方は、結論は言いません。これを理解しなければなりません。とても重要なメソットです。すべてを言わないことは、聞き手に機会を与えること。すべての答えは不完全。マスターは方向性だけを伝えます。極限に達した時、何が残るかわかるでしょう。禅を知的に理解しようとすると失敗します。問題に対する答えではなく、答え以上の何かです。そいれはまさしく現実を示しています。仏性は遠くの何かではありません。意識が仏性で自然です。意識は世界を構成しているものを見せてくれます。世界は終わっても鏡は残りますが、それには何も映りません。"},
  "23": {"title": "THE MASTER マスター", 
  "desc": "禅のマスターは他者に対するマスターではなく、自分自身のマスターです。マスターの周りに自然に形成される探求者たちのコミュニティーは、ユニークな個人それそれが自分自身の内なる光を見いだすのを支えてくれるエネルギーフィールドになります。"}
};

function shuffleArray(arr) {
  for(let i = arr.length -1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

const ids = shuffleArray([...Array(cardCount).keys()].map(x => x + 1));

for (let i = 0; i < cardCount; i++) {
  const card = document.createElement('div');
  card.classList.add('card');
  card.dataset.id = ids[i];

  const img = document.createElement('img');
  img.src = 'img/0.jpg';
  img.alt = 'タロットカード';

  card.appendChild(img);
  container.appendChild(card);
  const description = document.getElementById('description');

  card.addEventListener('click', () => {
    const id = card.dataset.id;

    if (selectedIds.has(id)) {
      //alert(`このカードは既に選択されています。`);
      return;
    }

    if (selectedIds.size >= 4) {
      alert('これ以上カードは選択できません。');
      return;
    }

    selectedIds.add(id);
    card.classList.add('selected');

    // カード画像表示
    const frontImg = document.createElement('img');
    frontImg.src = `img/${id}.jpg`;
    frontImg.alt = `カード${id}`;
    selected.appendChild(frontImg);

    // 説明表示更新
    const descDiv = document.getElementById('description');
    const order = selectedIds.size; // 1,2,3 の順

    // JSONからタイトル・説明取得
    const cardData = titles[id];
    const titleText = cardData.title || '';
    const descText = cardData.desc || '';

    // p要素を作って順番つきタイトルと説明をセット
    const p = document.createElement('p');
    p.innerHTML = `<b>【${order}枚目】${titleText}</b><br>${descText}`;
    descDiv.appendChild(p);
  });
}

document.getElementById('reset-button').addEventListener('click', () => {
  location.reload();
});

//スマホの挙動。
if (window.matchMedia("(pointer: coarse)").matches) {  
  const cards = document.querySelectorAll('.card');
  let currentHover = null;

  cards.forEach(card => {
    card.addEventListener('touchstart', (e) => {
      e.preventDefault(); // 必要に応じてコメントアウトしてテスト
      if (currentHover) {
        currentHover.classList.remove('hovered');
      }
      currentHover = card;
      currentHover.classList.add('hovered');
    });
    
    card.addEventListener('touchmove', (e) => {
      const touch = e.touches[0];
      const target = document.elementFromPoint(touch.clientX, touch.clientY);
      const newHover = target && target.closest('.card');
    
      if (newHover !== currentHover) {
        if (currentHover) {
          currentHover.classList.remove('hovered');
        }
    
        if (newHover) {
          newHover.classList.add('hovered');
        }
    
        currentHover = newHover;
      }
    });

    card.addEventListener('touchend', () => {
      if (currentHover) {
        currentHover.classList.remove('hovered');
        currentHover.click();
        currentHover = null;
      }
    });

    card.addEventListener('touchcancel', () => {
      if (currentHover) {
        currentHover.classList.remove('hovered');
        currentHover = null;
      }
    });
  });
}
